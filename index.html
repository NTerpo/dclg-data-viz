<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>DLCG data visualisation</title>
    <style>
        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }

        .axis text {
            font-family: sans-serif;
            font-size: 11px;
        }
        #tooltip {
                position: absolute;
                width: 200px;
                height: auto;
                padding: 10px;
                background-color: white;
                -webkit-border-radius: 10px;
                -moz-border-radius: 10px;
                border-radius: 10px;
                -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                pointer-events: none;
        }

        #tooltip.hidden {
                display: none;
        }

        #tooltip p {
                margin: 0;
                font-family: sans-serif;
                font-size: 16px;
                line-height: 20px;
        }
    </style>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
</head>

<body>
    
    <div id="tooltip" class="hidden">
            <p><strong>Important Label Heading</strong></p>
            <p><span id="value">100</span>%</p>
    </div>
    
    <script>
        var width = 1000,
            height = 750;
        
        var padding = 20;
        
        var limit = 200;
               
        var svg = d3.select("body")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);
        
        var color = d3.scale.quantize()
								.range(["rgb(0,255,0)", "rgb(255,255,0)",
                                "rgb(255,128,0)", "rgb(255,0,0)"]);
        queue()
            .defer(d3.csv, "house-building-starts-tenure.csv")
            .defer(d3.csv, "house-building-completions-tenure.csv")
            .await(ready);
            
        function ready (error, starts, completed) {
            var xScale = d3.scale.linear()
                                    .domain([0, d3.max(starts, function(d) { return d.id; })])
                                    .range([padding, width - padding]);
            var yScale = d3.scale.linear()
                                    .domain([0, d3.max(starts, function(d) { return d.id; })])
                                    .range([padding, height - padding]);
            
            var correlation = [];
            
            for (var i = 0; i < starts.length; i++) {
                correlation.push(Math.abs(starts[i].value - completed[i].value))
            }
            // console.log(correlation);
            // console.log(correlation.length)
            console.log(d3.max(correlation));
            
			// Color quantize scale					
			color.domain([0, limit]);
            
            // Pass starts data to svg
            svg.selectAll("start.circle")
                .data(starts)
                .enter()
                .append("circle")
                .attr("cx", function (d) {
                    return xScale(d.id) ; 
                })
                .attr("cy", function (d) {
                    return height - yScale(d.id) + 2 * Math.sqrt(correlation[d.id -1]);
                })
                .attr("r", function (d) {
                    return Math.sqrt(Math.abs(d.value))/5;
                })
                .style("fill", function (d) {
                    if (correlation[d.id -1] == 0) {
                        return "rgb(0,0,255)"
                    } else {
                        return color(correlation[d.id -1]);   
                    }
                })
                .on("mouseover", function(d) {

                    //Get this circle's x/y values, then augment for the tooltip
                    var xPosition = parseFloat(d3.select(this).attr("cx")) ;
                    var yPosition = parseFloat(d3.select(this).attr("cy")) / 2 + height / 2 ;

                    //Update the tooltip position and value
                    d3.select("#tooltip")
                      .style("left", xPosition + "px")
                      .style("top", yPosition + "px")
                      .text(d.name + "Council : " + d.value );

                    //Show the tooltip
                    d3.select("#tooltip").classed("hidden", false);
                })
                .on("mouseout", function() {

                    //Hide the tooltip
                    d3.select("#tooltip").classed("hidden", true);

                });
                
                
            // Pass completed data to svg    
            svg.selectAll("completed.circle")
                .data(completed)
                .enter()
                .append("circle")
                .attr("cx", function (d) {
                    return xScale(d.id) ; 
                })
                .attr("cy", function (d) {
                    return height - yScale(d.id) - 2 * Math.sqrt(correlation[d.id -1]) ;
                })
                .attr("r", function (d) {
                    return Math.sqrt(Math.abs(d.value))/5;
                })
                .style("fill", function (d) {
                    if (correlation[d.id -1] == 0) {
                        return "rgb(0,0,255)"
                    } else {
                        return color(correlation[d.id -1]);   
                    }
                })
                .on("mouseover", function(d) {

                    // Get this circle's x/y values, then augment for the tooltip
                    var xPosition = parseFloat(d3.select(this).attr("cx")) ;
                    var yPosition = parseFloat(d3.select(this).attr("cy")) / 2 + height / 2 ;

                    // Update the tooltip position and value
                    d3.select("#tooltip")
                      .style("left", xPosition + "px")
                      .style("top", yPosition + "px")
                      .text(d.name + "Council : " + d.value );

                    // Show the tooltip
                    d3.select("#tooltip").classed("hidden", false);
                    
 -->                   // Stroke circle
                    d3.select(this)
                        .attr("stroke-width", 1)
                        .attr("stroke", "black");
                })
                .on("mouseout", function() {

                    //Hide the tooltip
                    d3.select("#tooltip").classed("hidden", true);
                    d3.select(this)
                        .attr("stroke", "none");

                }); 
                
            // Axis
            svg.append("g")
                .attr("class", "axis") 
                .attr("transform", "translate(0," + (height - padding) + ")")     
                .call(d3.svg.axis()
                .scale(xScale)
                .orient("bottom")
                .ticks(5))
                .append("text")
                .attr("class", "label")
                .attr("x", width - padding)
                .attr("y", -6)
                .style("text-anchor", "end")
                .text("dataset 1");
            
            svg.append("g")
                .attr("class", "axis") 
                .attr("transform", "translate(" + padding + ",0)")
                .call(d3.svg.axis()
                .scale(yScale)
                .orient("left")
                .ticks(5))
                .append("text")
                .attr("class", "label")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("dataset 2");
            
        }
     
    </script>
</body>
</html>
