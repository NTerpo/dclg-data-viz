<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Housing in England</title>

    <style>
        h1 {
            font-size: 32px;
              font-family:Arial, Helvetica, sans-serif;
              color: ;
              padding:16px;
              font-weight:lighter;
              text-align:center;
              display:block;
              margin:16px;
        }
        .x.axis path,
        .x.axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }
        .x.axis text {
            font-family: sans-serif;
            font-size: 10px;
        }
        .y.axis path,
        .y.axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }
        .y.axis text {
            font-family: sans-serif;
            font-size: 10px;
        }
        .area {
            fill: rgb(222,235,247);
        }
        .label {
            font-family: sans-serif;
            font-size: 10px;
        }
        .dataset {
            position:absolute;
            top: 125px;
            left: 1000px;
            width: 230px;
            height: 200px;
            padding: 10px;
            background-color: rgb(49,130,189);
            border: 0;
            text-align: center;
            font-size: 15px;
            color: white;
        }
        .dataset:hover{
          background-color: rgb(158,202,225);
          cursor: pointer;
        }
        #house_building {
        }
        #house_price {
            top: 350px;
        }
        #households_pe_ratio {
            top: 575px;
        }
        .circles:hover {
          cursor: pointer;
        }
        #tooltip {
            position: absolute;
            width: 200px;
            height: auto;
            padding: 5px;
            background-color: rgb(245,245,245);
            opacity: 0.7;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        }
        #tooltip.hidden {
            display: none;
        }
        #tooltip p {
            margin: 0;
            font-family: Arial, "Lucida Grande", sans-serif;
            line-height: 15px;
        }
        #tooltip span {
            font-family: sans-serif;
            font-size: 10px;
        }
        #tooltip a{
            text-decoration: none
         }       
    </style>

    <!-- d3.js library -->
    <script src="http://d3js.org/d3.v3.min.js"></script>
    
</head>

<body>
    <h1>Housing Market in England</h1>
    
    <div id="datasets">
        <button class="dataset" id="house_building">
            <h2>House building</h2>
            <p>Number of houses completed against started by district </br> 2012-13</p>
        </button>
        </br>
        <button class="dataset" id="house_price">
            <h2>House Price</h2>
            <p>Evolution of the price/earnings ratio against number of houses started</br> 2011-12</p>
        </button>
        <button class="dataset" id="households_pe_ratio">
            <h2>Households Accommodation</h2>
            <p>Households in Temporary Accommodation against houses price/earnings ratio </br> 2013</p>
        </button>
    </div>
    
    <div id="tooltip" class="hidden">
        <p></p>
    </div>
    
    <script>
        var width = 1000,
            height = 700;

        var padding = 40;
        
        var formatSi = d3.format(".4");

        var svg = d3.select("body")
                    .append("svg")
                    .attr("id", "svg")
                    .attr("width", width)
                    .attr("height", height);

        // SPARQL query to get data from two sources in a .CSV + NOMIS API
        var datasource_house_building = "http://opendatacommunities.org/sparql.csv?query=PREFIX+time%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Ftime%2F%3E%0D%0APREFIX+geo%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fgeography%2F%3E%0D%0APREFIX+gov%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Flocal-government%2F%3E%0D%0APREFIX+osgeo%3A++%3Chttp%3A%2F%2Fdata.ordnancesurvey.co.uk%2Fontology%2Fadmingeo%2F%3E%0D%0APREFIX+yr%3A+%3Chttp%3A%2F%2Freference.data.gov.uk%2Fid%2Fyear%2F%3E%0D%0APREFIX+year%3A+%3Chttp%3A%2F%2Freference.data.gov.uk%2Fid%2Fgovernment-year%2F%3E%0D%0APREFIX+quarter%3A+%3Chttp%3A%2F%2Freference.data.gov.uk%2Fid%2Fquarter%2F%3E%0D%0APREFIX+period%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Ftime%2F%3E%0D%0APREFIX+cube%3A+%3Chttp%3A%2F%2Fpurl.org%2Flinked-data%2Fcube%23%3E%0D%0APREFIX+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX+type%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX+building%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhouse-building%2F%3E%0D%0APREFIX+starts%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhouse-building%2Fstarts%2F%3E%0D%0APREFIX+compl%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhouse-building%2Fcompletions%2F%3E%0D%0APREFIX+stock%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhousing-market%2Fdwelling-stock%2F%3E%0D%0APREFIX+market%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhousing-market%2F%3E%0D%0A%0D%0ASELECT+%3FauthorityName+%3Fstarts+%3Fcompletions+%3FdwellingStock+%3FgssCode+%3FrefArea+%3Fobservation+%3Fobservation2+%3Fobservation3+WHERE+%7B+%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fhouse-building%2Fcompletions%2Ftenure%3E+%7B+%0D%0A++++++%3Fobservation+rdf%3Atype+cube%3AObservation+%3B%0D%0A+++++++++++++++++++time%3ArefPeriod+year%3A2012-2013+%3B+%0D%0A+++++++++++++++++++geo%3ArefArea+%3FrefArea+%3B+%0D%0A+++++++++++++++++++compl%3Atenure+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fconcept%2Fgeneral-concepts%2Ftenure%2Fall%3E+%3B%0D%0A+++++++++++++++++++building%3AcompletionsObs+%3Fcompletions+.%0D%0A+++%7D%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fhouse-building%2Fstarts%2Ftenure%3E+%7B+%0D%0A++++++%3Fobservation2+rdf%3Atype+cube%3AObservation+%3B%0D%0A++++++++++++++++++++time%3ArefPeriod+year%3A2012-2013+%3B+%0D%0A++++++++++++++++++++starts%3Atenure+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fconcept%2Fgeneral-concepts%2Ftenure%2Fall%3E+%3B%0D%0A++++++++++++++++++++geo%3ArefArea+%3FrefArea+%3B+%0D%0A++++++++++++++++++++building%3AstartsObs+%3Fstarts+.%0D%0A+++%7D%0D%0A%0D%0A++++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fhousing-market%2Fdwelling-stock%2Ftenure%3E+%7B+%0D%0A++++++%3Fobservation3+rdf%3Atype+cube%3AObservation+%3B%0D%0A+++++++++++++++++++period%3ArefPeriod+yr%3A2012+%3B+%0D%0A+++++++++++++++++++geo%3ArefArea+%3FrefArea+%3B+%0D%0A+++++++++++++++++++stock%3Atenure+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fconcept%2Fhousing-market%2Fdwelling-stock%2Ftenure%2Ftotal%3E+%3B%0D%0A+++++++++++++++++++market%3AdwellingStockObs+%3FdwellingStock+.%0D%0A+++%7D%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fontology%2Fgeography%2Fons-labels%3E+%7B%0D%0A+++++%3FrefArea+osgeo%3AgssCode+%3FgssCode+%3B+%0D%0A++++++++++++++gov%3AisGovernedBy+%3Fauthority+.%0D%0A+++%7D%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Flocal-authorities%3E+%7B+%0D%0A++++++%3Fauthority+++type%3Atype+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Flocal-government%2FLocalAuthority%3E+%3B%0D%0A+++++++++++++++++++rdfs%3Alabel+%3FauthorityName+.%0D%0A+++%7D%0D%0A%0D%0A%7D+ORDER+BY%28%3Fstarts%29";
        var datasource_house_price = "http://opendatacommunities.org/sparql.csv?query=PREFIX+time%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Ftime%2F%3E%0D%0APREFIX+geo%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fgeography%2F%3E%0D%0APREFIX+gov%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Flocal-government%2F%3E%0D%0APREFIX+osgeo%3A++%3Chttp%3A%2F%2Fdata.ordnancesurvey.co.uk%2Fontology%2Fadmingeo%2F%3E%0D%0APREFIX+yr%3A+%3Chttp%3A%2F%2Freference.data.gov.uk%2Fid%2Fyear%2F%3E%0D%0APREFIX+year%3A+%3Chttp%3A%2F%2Freference.data.gov.uk%2Fid%2Fgovernment-year%2F%3E%0D%0APREFIX+quarter%3A+%3Chttp%3A%2F%2Freference.data.gov.uk%2Fid%2Fquarter%2F%3E%0D%0APREFIX+period%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Ftime%2F%3E%0D%0APREFIX+cube%3A+%3Chttp%3A%2F%2Fpurl.org%2Flinked-data%2Fcube%23%3E%0D%0APREFIX+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX+type%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX+building%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhouse-building%2F%3E%0D%0APREFIX+starts%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhouse-building%2Fstarts%2F%3E%0D%0APREFIX+compl%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhouse-building%2Fcompletions%2F%3E%0D%0APREFIX+stock%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhousing-market%2Fdwelling-stock%2F%3E%0D%0APREFIX+market%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhousing-market%2F%3E%0D%0A%0D%0ASELECT+%3FauthorityName+%3Fstarts+%3Fperatio2012+%3Fperatio2011+%3FdwellingStock+%3FgssCode+%3FrefArea+%3Fobservation+%3Fobservation2+%3Fobservation3+%3Fobservation4+WHERE+%7B+%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fhouse-building%2Fstarts%2Ftenure%3E+%7B+%0D%0A++++++%3Fobservation+rdf%3Atype+cube%3AObservation+%3B%0D%0A++++++++++++++++++++time%3ArefPeriod+year%3A2011-2012+%3B+%0D%0A++++++++++++++++++++starts%3Atenure+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fconcept%2Fgeneral-concepts%2Ftenure%2Fall%3E+%3B%0D%0A++++++++++++++++++++geo%3ArefArea+%3FrefArea+%3B+%0D%0A++++++++++++++++++++building%3AstartsObs+%3Fstarts+.%0D%0A+++%7D%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fhousing-market%2Fratio%2Fhouse-prices-ratio%2Fmed-house-price-to-earnings%3E+%7B+%0D%0A++++++%3Fobservation2+rdf%3Atype+cube%3AObservation+%3B%0D%0A++++++++++++++++++++++time%3ArefPeriod+yr%3A2012+%3B+%0D%0A++++++++++++++++++++++geo%3ArefArea+%3FrefArea+%3B+%0D%0A++++++++++++++++++++++market%3AratioObs+%3Fperatio2012+.%0D%0A++++++%7D%0D%0A++++++%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fhousing-market%2Fratio%2Fhouse-prices-ratio%2Fmed-house-price-to-earnings%3E+%7B+%0D%0A++++++%3Fobservation3+rdf%3Atype+cube%3AObservation+%3B%0D%0A+++++++++++++++++++++++++time%3ArefPeriod+yr%3A2011+%3B+%0D%0A+++++++++++++++++++++++++geo%3ArefArea+%3FrefArea+%3B+%0D%0A+++++++++++++++++++++++++market%3AratioObs+%3Fperatio2011+.%0D%0A+++++++++%7D++%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fhousing-market%2Fdwelling-stock%2Ftenure%3E+%7B+%0D%0A++++++%3Fobservation4+rdf%3Atype+cube%3AObservation+%3B%0D%0A+++++++++++++++++++period%3ArefPeriod+yr%3A2012+%3B+%0D%0A+++++++++++++++++++geo%3ArefArea+%3FrefArea+%3B+%0D%0A+++++++++++++++++++stock%3Atenure+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fconcept%2Fhousing-market%2Fdwelling-stock%2Ftenure%2Ftotal%3E+%3B%0D%0A+++++++++++++++++++market%3AdwellingStockObs+%3FdwellingStock+.%0D%0A+++%7D%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fontology%2Fgeography%2Fons-labels%3E+%7B%0D%0A+++++%3FrefArea+osgeo%3AgssCode+%3FgssCode+%3B+%0D%0A++++++++++++++gov%3AisGovernedBy+%3Fauthority+.%0D%0A+++%7D%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Flocal-authorities%3E+%7B+%0D%0A++++++%3Fauthority+++type%3Atype+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Flocal-government%2FLocalAuthority%3E+%3B%0D%0A+++++++++++++++++++rdfs%3Alabel+%3FauthorityName+.%0D%0A+++%7D%0D%0A%0D%0A%7D+ORDER+BY%28%3Fstarts%29";
        var datasource_households_pe_ratio = "http://opendatacommunities.org/sparql.csv?query=PREFIX+time%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Ftime%2F%3E%0D%0APREFIX+geo%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fgeography%2F%3E%0D%0APREFIX+gov%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Flocal-government%2F%3E%0D%0APREFIX+osgeo%3A++%3Chttp%3A%2F%2Fdata.ordnancesurvey.co.uk%2Fontology%2Fadmingeo%2F%3E%0D%0APREFIX+yr%3A+%3Chttp%3A%2F%2Freference.data.gov.uk%2Fid%2Fyear%2F%3E%0D%0APREFIX+year%3A+%3Chttp%3A%2F%2Freference.data.gov.uk%2Fid%2Fgovernment-year%2F%3E%0D%0APREFIX+quarter%3A+%3Chttp%3A%2F%2Freference.data.gov.uk%2Fid%2Fquarter%2F%3E%0D%0APREFIX+period%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Ftime%2F%3E%0D%0APREFIX+cube%3A+%3Chttp%3A%2F%2Fpurl.org%2Flinked-data%2Fcube%23%3E%0D%0APREFIX+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX+building%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhouse-building%2F%3E%0D%0APREFIX+starts%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhouse-building%2Fstarts%2F%3E%0D%0APREFIX+compl%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhouse-building%2Fcompletions%2F%3E%0D%0APREFIX+stock%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhousing-market%2Fdwelling-stock%2F%3E%0D%0APREFIX+market%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhousing-market%2F%3E%0D%0APREFIX+households%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fontology%2Fhomelessness%2F%3E%0D%0APREFIX+accommodated%3A+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fconcept%2Fhomelessness%2Fhouseholds-accommodated%2F%3E%0D%0A%0D%0ASELECT+%3FauthorityName+%3Fhouseholds+%3Fperatio+%3FdwellingStock+%3FgssCode+%3FrefArea+%3Fobservation+%3Fobservation2+%3Fobservation3+WHERE+%7B+%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fhomelessness%2Fhouseholds-accommodated-per-1000%2Ftemporary-housing-types%3E+%7B+%0D%0A++++++%3Fobservation+rdf%3Atype+cube%3AObservation+%3B%0D%0A+++++++++++++++++++time%3ArefPeriod+quarter%3A2013-Q4+%3B+%0D%0A+++++++++++++++++++geo%3ArefArea+%3FrefArea+%3B+%0D%0A+++++++++++++++++++households%3AhouseholdsAccommodatedPer1000Obs+%3Fhouseholds+.%0D%0A+++%7D%0D%0AGRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fhousing-market%2Fratio%2Fhouse-prices-ratio%2Fmed-house-price-to-earnings%3E+%7B+%0D%0A++++++%3Fobservation2+rdf%3Atype+cube%3AObservation+%3B%0D%0A+++++++++++++++++++time%3ArefPeriod+yr%3A2012+%3B+%0D%0A+++++++++++++++++++geo%3ArefArea+%3FrefArea+%3B+%0D%0A+++++++++++++++++++market%3AratioObs+%3Fperatio+.%0D%0A+++%7D%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fhousing-market%2Fdwelling-stock%2Ftenure%3E+%7B+%0D%0A++++++%3Fobservation3+rdf%3Atype+cube%3AObservation+%3B%0D%0A+++++++++++++++++++period%3ArefPeriod+yr%3A2012+%3B+%0D%0A+++++++++++++++++++geo%3ArefArea+%3FrefArea+%3B+%0D%0A+++++++++++++++++++stock%3Atenure+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fdef%2Fconcept%2Fhousing-market%2Fdwelling-stock%2Ftenure%2Ftotal%3E+%3B%0D%0A+++++++++++++++++++market%3AdwellingStockObs+%3FdwellingStock+.%0D%0A+++%7D%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Fontology%2Fgeography%2Fons-labels%3E+%7B%0D%0A+++++%3FrefArea+osgeo%3AgssCode+%3FgssCode+%3B+%0D%0A++++++++++++++gov%3AisGovernedBy+%3Fauthority+.%0D%0A+++%7D%0D%0A%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fopendatacommunities.org%2Fgraph%2Flocal-authorities%3E+%7B+%0D%0A++++++%3Fauthority+rdfs%3Alabel+%3FauthorityName+.%0D%0A+++%7D%0D%0A%0D%0A%7D+ORDER+BY%28%3Fperatio%29";
        
        var nomisData = "http://www.nomisweb.co.uk/api/v01/dataset/NM_17_5.data.csv?geography=1946157057...1946157382&date=latest&variable=MAKE|Employment%20rate%20-%20aged%2016-64|28|22&measures=20599,21001,21002,21003&select=geography_code,measures_name,obs_value"
        
        var datasource =    [datasource_house_building,
                            datasource_house_price,
                            datasource_households_pe_ratio
                            ];

        // Used to select the dataset to show                        
        var ds = 0;
        
        // Color - jobs density data
        var color = d3.scale.log()
                            .domain([50, 95])
                            .range(['rgb(240,59,32)','rgb(255,237,160)']);

        // Loading data     
        d3.csv(datasource[ds], function (data) {
            // Scaling
            var xScale = d3.scale.log()
                                    .domain([10, d3.max(data, function (d) {
                                                    return parseInt(d.starts) ;
                                                })
                                            ])
                                    .range([padding, width - padding]);
            var yScale = d3.scale.log()
                                    .domain([10, d3.max(data, function (d) {
                                                    return parseInt(d.completions) ;
                                                })
                                            ])
                                    .range([height - padding, padding]);

            // Acceptable values domain
            svg.append("path")
                .datum(data)
                .attr("class", "area")
                .attr("d", d3.svg.area()
                    .x(function (d) {
                        if (parseInt(d.starts) === 0) {
                            return xScale(10);
                        } else {
                            return xScale(d.starts);
                        }
                    })
                    .y0(function (d) {
                        if (parseInt(d.starts) < 10) {
                            return height - padding;
                        } else {
                            return yScale(1.3 * d.starts);
                        }
                    })
                    .y1(function (d) {
                        if (parseInt(d.starts) < 10) {
                            return height - padding;
                        } else {
                            return yScale(0.7 * d.starts);
                        }
                    })
                ); 

            // Merge dataset with NOMIS dataset
            d3.csv(nomisData, function (nomis) {
                for (var i = 0; i < data.length; i++) {
                    // Grab GSS code from ODC dataset
                    var dataGss = data[i].gssCode;

                    for (var j = 0; j < nomis.length; j++) {

                        var nomisGss = nomis[j].GEOGRAPHY_CODE;

                        if (dataGss == nomisGss) {
                            // Select the data
                            if (nomis[j].MEASURES_NAME == "Variable") {
                                // Copy job density value into the ODC csv
                                data[i].job = nomis[j].OBS_VALUE;
                                break;
                            }
                        } 
                    }
                }
                
                // Pass data to svg
                svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("class", "circles")
                    .attr("cx", function (d) {
                        if (parseInt(d.starts) === 0) {
                            return xScale(5);
                        } else {
                            return xScale(d.starts);
                        }
                    })
                    .attr("cy", function (d) {
                        if (parseInt(d.completions) === 0) {
                            return yScale(5);
                        } else {
                            return yScale(d.completions);
                        }
                    })
                    .attr("r", function (d) {
                        return (2.5 + 0.008 * Math.sqrt(d.dwellingStock));
                    })
				    .style("fill", function (d) {
				        return color(d.job);
				    })
                    .on("click", function (d, i) {
                        var tooltip = d3.select("#tooltip");
                        if (tooltip.classed("hidden") == true) {

                            // Define and show the tooltip

                            // Get this circle's x/y values, then augment for the tooltip
                            var xPosition = 0;
                            if (parseFloat(d3.select(this).attr("cx")) < ((4 * width) / 5)) {
                                xPosition = parseFloat(d3.select(this).attr("cx")) + 15;
                            } else {
                                xPosition = parseFloat(d3.select(this).attr("cx")) - 25 - 185;
                            }

                            var yPosition = parseFloat(d3.select(this).attr("cy")) / 2 + height / 10;

                            // Update the tooltip position and value
                            d3.select("#tooltip")
                                .style("left", xPosition + "px")
                                .style("top", yPosition + "px")
                                .html('<h3>' + '<a href = "' + d.refArea + '" target="_blank">' + d.authorityName + '</a>' + 
                                    '</h3>' + 

                                    '<span>' + 
                                    "Completed house building " + (d.observation).split("/")[7] + " : " + 
                                    '</span>' +

                                    '<a href = "' + d.observation + '" target="_blank">' + d.completions + '</a>' + 
                                    '</br>' +

                                    '<span>' +
                                    "Started house building " + (d.observation).split("/")[7] + " : " +  
                                    '</span>' +

                                    '<a href = "' + d.observation2 + '" target="_blank">' + d.starts + '</a>' + 
                                    '</br>' + 

                                    '<span>' +
                                    "Dwelling Stock " 
                                    + (d.observation3).split("/")[7] + " : " + 
                                    '</span>' +

                                    '<a href = "' + d.observation3 + '" target="_blank">' + d.dwellingStock + '</a>' + 
                                    '</br>' + 

                                    '<span>' +
                                    "Employment rate: " + 
                                    '</span>' +

                                    d.job
                                    );

                            // Show the tooltip
                            d3.select("#tooltip").classed("hidden", false);
                        }  else {
                            //Hide the tooltip
                            d3.select("#tooltip").classed("hidden", true);
                        }
                    })
                    .on("mouseover", over)
                    .on("mouseout", out);

                // Over function, called on mouseover
                function over (d, i) {
                    d3.select(this)
                        .attr("stroke-width", 1.5)
                        .attr("stroke", "black");
                }

                // Out function, called on mouseout
                function out (d, i) {
                    d3.select(this)
                        .attr("stroke", "none");
                }

                // Loader
                svg.append("image")
                    .attr("class", "load")
                    .attr("xlink:href", "loader.gif")
                    .attr("x", width / 2)
                    .attr("y", height / 2)
                    .attr("width", 32)
                    .attr("height", 32)
                    .style("display", "none");

                // Axis and legends 
                // Axis

                svg.append("g")
                    .attr("class", "x axis") 
                    .attr("transform", "translate(0," + (height - padding) + ")")     
                    .call(d3.svg.axis()
                    .scale(xScale)
                    .orient("bottom")
                    .ticks(5, function(d, i) {
                        return formatSi(d);
                    }))
                   .append("text")
                    .attr("class", "label")
                    .attr("id", "xAxisLabel")
                    .attr("x", width - padding)
                    .attr("y", -6)
                    .style("text-anchor", "end")
                    .text("Started building house 2012-13");

                svg.append("g")
                    .attr("class", "y axis") 
                    .attr("transform", "translate(" + padding + ",0)")
                    .call(d3.svg.axis()
                    .scale(yScale)
                    .orient("left")
                    .ticks(5, function(d, i) {
                        return formatSi(d);
                    }))
                   .append("text")
                    .attr("class", "label")
                    .attr("id", "yAxisLabel")
                    .attr("transform", "rotate(-90)")
                    .attr("x", - padding)
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Completed building house 2012-13");

                // used for the house price visualization
                svg.append("line")
                    .attr("class", "line")
                    .attr("stroke-width", 0.8)
                    .attr("stroke", "black")
                    .style("display", "none");    
                    
                // Legend area
                svg.append("rect")
                    .attr("x", width - 58)
                    .attr("y", height - padding - 43)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", "rgb(222,235,247)");

                svg.append("text")
                    .attr("class", "label")
                    .attr("x", width - 60)
                    .attr("y", height - padding - 35)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text("Y = +/- 30% X");
                    
                // Legend circles 
                svg.append("rect")
                    .attr("class", "legend")
                    .attr("x", width - 155)
                    .attr("y", height - padding - 80)
                    .attr("width", 110)
                    .attr("height", 10)
                    .style("fill", "url(#gradient)");
                    
                svg.append("linearGradient")
                    .attr("id", "gradient")
                    .attr("x1", "0%")
                    .attr("y1", "0%")
                    .attr("x2", "100%")
                    .attr("y2", "0%")
                   .selectAll("stop")
                    .data([
                        {offset: "0%", color: color.range()[0]},
                        {offset: "100%", color: color.range()[1]}
                    ])
                   .enter().append("stop")
                    .attr("offset", function(d) { return d.offset; })
                    .attr("stop-color", function(d) { return d.color; });   
                
                svg.append("text")
                    .attr("class", "label")
                    .attr("x", width - 40)
                    .attr("y", height - padding - 60)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text("> " + color.domain()[1]);
                
                svg.append("text")
                    .attr("class", "label")
                    .attr("x", width - 135)
                    .attr("y", height - padding - 60)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text(color.domain()[0] + " <");

                svg.append("text")
                    .attr("class", "label")
                    .attr("x", width - 60)
                    .attr("y", height - padding - 90)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text("Employment rate"); 
            })
        });

        // When clicking on the House Prices' button 
        d3.select("#house_price")
            .on("click", function () {
                d3.select("image").style("display", "block");

                ds = 1;

                d3.csv(datasource[ds], function (data) {
                    // Key function to bind data to element via gsscode
                    var key = function(d) {
                        return d.gssCode;
                    };

                    // Merge dataset with NOMIS dataset
                    d3.csv(nomisData, function (nomis) {
                        for (var i = 0; i < data.length; i++) {
                            // Grab GSS code from ODC dataset
                            var dataGss = data[i].gssCode;

                            for (var j = 0; j < nomis.length; j++) {

                                var nomisGss = nomis[j].GEOGRAPHY_CODE;

                                if (dataGss == nomisGss) {
                                    // Select the data
                                    if (nomis[j].MEASURES_NAME == "Variable") {
                                        // Copy job density value into the ODC csv
                                        data[i].job = nomis[j].OBS_VALUE;
                                        break;
                                    }
                                } 
                            }
                        }
                        d3.select("image").style("display", "none");

                        // Update scale domain
                        var xScale = d3.scale.log()
                                                .domain([10, d3.max(data, function (d) {
                                                                return parseInt(d.starts) ;
                                                            })
                                                        ])
                                                .range([padding, width - padding]);
                        var yScale = d3.scale.linear()
                                                .domain([d3.min(data, function (d) {
                                                                return (parseFloat(d.peratio2012) - parseFloat(d.peratio2011));
                                                            }), 
                                                        d3.max(data, function (d) {
                                                                return (parseFloat(d.peratio2012) - parseFloat(d.peratio2011));
                                                            })
                                                        ])
                                                .range([height - padding, padding]);

                        // Update axis
                        svg.select(".x.axis")
                            .transition()
                            .duration(1000)
                            .call(d3.svg.axis()
                                .scale(xScale)
                                .orient("bottom")
                                .ticks(5, function(d, i) {
                                            return formatSi(d);
                                        })
                            );

                        svg.select(".y.axis")
                            .transition()
                            .duration(1000)
                            .call(d3.svg.axis()
                                .scale(yScale)
                                .orient("left")
                                .ticks(5, function(d, i) {
                                            return formatSi(d);
                                        })
                            );

                        svg.select("#xAxisLabel")
                            .text("Started building house 2011-12");
                        svg.select("#yAxisLabel")
                            .text("DELTA Ratio Prices/Earnings 2011-12"); 

                        d3.select(".area").style("display", "none");
                        d3.select(".line")
                            .attr("x1", padding)
                            .attr("y1", yScale(0))
                            .attr("x2", width - padding)
                            .attr("y2", yScale(0))
                            .style("display", "block");

                        // Pass data to svg
                        svg.selectAll("circle")
                            .data(data, key)
                            .transition()                     
                            .duration(1000)
                            .attr("cx", function (d) {
                                if (parseInt(d.starts) === 0) {
                                    return xScale(5);
                                } else {
                                    return xScale(d.starts);
                                }
                            })
                            .attr("cy", function (d) {
                                return yScale(d.peratio2012 - d.peratio2011);
                            })
                            .attr("r", function (d) {
                                return (2.5 + 0.008 * Math.sqrt(d.dwellingStock));
                            })
                            .style("fill", function (d) {
                                return color(d.job);
                            })
                            .transition()
                            .duration(400);

                        svg.selectAll("circle")
                            .data(data, key)
                            .on("click", function (d) {
                                var tooltip = d3.select("#tooltip");
                                if (tooltip.classed("hidden") == true) {

                                    // Define and show the tooltip

                                    // Get this circle's x/y values, then augment for the tooltip
                                    var xPosition = 0;
                                    if (parseFloat(d3.select(this).attr("cx")) < ((4 * width) / 5)) {
                                        xPosition = parseFloat(d3.select(this).attr("cx")) + 15;
                                    } else {
                                        xPosition = parseFloat(d3.select(this).attr("cx")) - 25 - 185;
                                    }

                                    var yPosition = parseFloat(d3.select(this).attr("cy")) / 2 + height / 10;

                                    // Update the tooltip position and value
                                    d3.select("#tooltip")
                                        .style("left", xPosition + "px")
                                        .style("top", yPosition + "px")
                                        .html(
                                            '<h3>' + '<a href = "' + d.refArea + '" target="_blank">' + d.authorityName + '</a>' + 
                                            '</h3>' + 

                                            '<span>' + 
                                            "Started house building " + (d.observation).split("/")[7] + " : " + 
                                            '</span>' +

                                            '<a href = "' + d.observation + '" target="_blank">' + d.starts + '</a>' + 
                                            '</br>' +

                                            '<span>' +
                                            "Ratio of median house price to median earnings 2012 " + (d.observation2).split("/")[7] + " : " +  
                                            '</span>' +

                                            '<a href = "' + d.observation2 + '" target="_blank">' + d.peratio2012 + '</a>' + 
                                            '</br>' + 
                                            
                                            '<span>' +
                                            "Ratio of median house price to median earnings 2011 " + (d.observation3).split("/")[7] + " : " +  
                                            '</span>' +

                                            '<a href = "' + d.observation3 + '" target="_blank">' + d.peratio2011 + '</a>' + 
                                            '</br>' + 

                                            '<span>' +
                                            "Dwelling Stock " 
                                            + (d.observation3).split("/")[7] + " : " + 
                                            '</span>' +

                                            '<a href = "' + d.observation3 + '" target="_blank">' + d.dwellingStock + '</a>' + 
                                            '</br>' + 

                                            '<span>' +
                                            "Employment rate: " + 
                                            '</span>' +
                                            d.job
                                        );

                                    // Show the tooltip
                                    d3.select("#tooltip").classed("hidden", false);
                                }  else {
                                    //Hide the tooltip
                                    d3.select("#tooltip").classed("hidden", true);
                                }
                            });    
                    });
                });    
            });

        // When clicking on the Households Accomodations' button 
        d3.select("#households_pe_ratio")
            .on("click", function () {
                d3.select("image").style("display", "block");

                ds = 2;

                d3.csv(datasource[ds], function (data) {
                    // Key function to bind data to element via gsscode
                    var key = function(d) {
                        return d.gssCode;
                    };

                    // Merge dataset with NOMIS dataset
                    d3.csv(nomisData, function (nomis) {
                        for (var i = 0; i < data.length; i++) {
                            // Grab GSS code from ODC dataset
                            var dataGss = data[i].gssCode;

                            for (var j = 0; j < nomis.length; j++) {

                                var nomisGss = nomis[j].GEOGRAPHY_CODE;

                                if (dataGss == nomisGss) {
                                    // Select the data
                                    if (nomis[j].MEASURES_NAME == "Variable") {
                                        // Copy job density value into the ODC csv
                                        data[i].job = nomis[j].OBS_VALUE;
                                        break;
                                    }
                                } 
                            }
                        }
                        d3.select("image").style("display", "none");
                        // Update scale domain
                        var xScale = d3.scale.log()
                                                .domain([d3.min(data, function (d) {
                                                            return parseFloat(d.peratio) ;
                                                        }), 
                                                        d3.max(data, function (d) {
                                                            return parseFloat(d.peratio) ;
                                                    })
                                                ])
                                                .range([padding, width - padding]);
                        var yScale = d3.scale.log()
                                                .domain([0.01, 
                                                        d3.max(data, function (d) {
                                                            return parseFloat(d.households) ;
                                                    })
                                                ])
                                                .range([height - padding, padding]);
                        // Update axis
                        svg.select(".x.axis")
                            .transition()
                            .duration(1000)
                            .call(d3.svg.axis()
                                .scale(xScale)
                                .orient("bottom")
                                .ticks(5, function(d, i) {
                                    return formatSi(d);
                                })
                            );

                        svg.select(".y.axis")
                            .transition()
                            .duration(1000)
                            .call(d3.svg.axis()
                                .scale(yScale)
                                .orient("left")
                                .ticks(5, function(d, i) {
                                    return formatSi(d);
                                })
                            );

                        svg.select("#xAxisLabel")
                            .text("Ratio of median house price to median earnings");
                        svg.select("#yAxisLabel")
                            .text("Households in temporary accommodation per 1000 households");

                        d3.select(".area").style("display", "none");
                        d3.select(".line").style("display", "none");

                        // Pass data to svg
                        svg.selectAll("circle")
                            .data(data, key)
                            .transition()                     
                            .duration(1000)
                            .attr("cx", function (d) {
                                return xScale(d.peratio);
                            })
                            .attr("cy", function (d) {
                                if (parseFloat(d.households) === 0) {
                                    return yScale(0.001);
                                } else {
                                    return yScale(d.households);
                                }
                            })
                            .attr("r", function (d) {
                                return (2.5 + 0.008 * Math.sqrt(d.dwellingStock));
                            })
                            .style("fill", function (d) {
                                return color(d.job);
                            })
                            .transition()
                            .duration(400);

                        svg.selectAll("circle")
                            .data(data, key)
                            .on("click", function (d) {
                                var tooltip = d3.select("#tooltip");
                                if (tooltip.classed("hidden") == true) {

                                    // Define and show the tooltip

                                    // Get this circle's x/y values, then augment for the tooltip
                                    var xPosition = 0;
                                    if (parseFloat(d3.select(this).attr("cx")) < ((4 * width) / 5)) {
                                        xPosition = parseFloat(d3.select(this).attr("cx")) + 15;
                                    } else {
                                        xPosition = parseFloat(d3.select(this).attr("cx")) - 25 - 185;
                                    }

                                    var yPosition = parseFloat(d3.select(this).attr("cy")) / 2 + height / 10;

                                    // Update the tooltip position and value
                                    d3.select("#tooltip")
                                        .style("left", xPosition + "px")
                                        .style("top", yPosition + "px")
                                        .html(
                                            '<h3>' + '<a href = "' + d.refArea + '" target="_blank">' + d.authorityName + '</a>' + 
                                            '</h3>' + 

                                            '<span>' + 
                                            "Households in temporary accommodation per 1000 households " + (d.observation).split("/")[7] + " : " + 
                                            '</span>' +

                                            '<a href = "' + d.observation + '" target="_blank">' + d.households + '</a>' + 
                                            '</br>' +

                                            '<span>' +
                                            "Ratio of median house price to median earnings " + (d.observation2).split("/")[7] + " : " +  
                                            '</span>' +

                                            '<a href = "' + d.observation2 + '" target="_blank">' + d.peratio + '</a>' + 
                                            '</br>' + 

                                            '<span>' +
                                            "Dwelling Stock " 
                                            + (d.observation3).split("/")[7] + " : " + 
                                            '</span>' +

                                            '<a href = "' + d.observation3 + '" target="_blank">' + d.dwellingStock + '</a>' + 
                                            '</br>' + 

                                            '<span>' +
                                            "Employment rate: " + 
                                            '</span>' +
                                            d.job
                                        );

                                    // Show the tooltip
                                    d3.select("#tooltip").classed("hidden", false);
                                }  else {
                                    //Hide the tooltip
                                    d3.select("#tooltip").classed("hidden", true);
                                }
                            });                
                    })
                });
            });

        // When clicking on the House buildings' button 
        d3.select("#house_building")
            .on("click", function () {
                d3.select("image").style("display", "block");

                ds = 0;

                d3.csv(datasource[ds], function (data) {
                    // Key function to bind data to element via gsscode
                    var key = function(d) {
                        return d.gssCode;
                    };

                    // Merge dataset with NOMIS dataset
                    d3.csv(nomisData, function (nomis) {
                        for (var i = 0; i < data.length; i++) {
                            // Grab GSS code from ODC dataset
                            var dataGss = data[i].gssCode;

                            for (var j = 0; j < nomis.length; j++) {

                                var nomisGss = nomis[j].GEOGRAPHY_CODE;

                                if (dataGss == nomisGss) {
                                    // Select the data
                                    if (nomis[j].MEASURES_NAME == "Variable") {
                                        // Copy job density value into the ODC csv
                                        data[i].job = nomis[j].OBS_VALUE;
                                        break;
                                    }
                                } 
                            }
                        }

                        d3.select("image").style("display", "none");
                        // Update scale domain
                        var xScale = d3.scale.log()
                                                .domain([10, d3.max(data, function (d) {
                                                                return parseInt(d.starts) ;
                                                            })
                                                        ])
                                                .range([padding, width - padding]);
                        var yScale = d3.scale.log()
                                                .domain([10, d3.max(data, function (d) {
                                                                return parseInt(d.completions) ;
                                                            })
                                                        ])
                                                .range([height - padding, padding]);

                        // Updte axis
                        svg.select(".x.axis")
                            .transition()
                            .duration(1000)
                            .call(d3.svg.axis()
                                .scale(xScale)
                                .orient("bottom")
                                .ticks(5, function(d, i) {
                                    return formatSi(d);
                                }));

                        svg.select(".y.axis")
                            .transition()
                            .duration(1000)
                            .call(d3.svg.axis()
                                .scale(yScale)
                                .orient("left")
                                .ticks(5, function(d, i) {
                                    return formatSi(d);
                                })
                            );

                        svg.select("#xAxisLabel")
                            .text("Started building house 2012-13");
                        svg.select("#yAxisLabel")
                            .text("Completed building house 2012-13");

                        d3.select(".area").style("display", "block");
                        d3.select(".line").style("display", "none");                        

                        // Pass data to svg
                        svg.selectAll("circle")
                            .data(data, key)
                            .transition()                     
                            .duration(1000)
                            .attr("cx", function (d) {
                                if (parseInt(d.starts) === 0) {
                                    return xScale(2);
                                } else {
                                    return xScale(d.starts);
                                }
                            })
                            .attr("cy", function (d) {
                                if (parseInt(d.completions) === 0) {
                                    return yScale(2);
                                } else {
                                    return yScale(d.completions);
                                }
                            })
                            .attr("r", function (d) {
                                return (2.5 + 0.008 * Math.sqrt(d.dwellingStock));
                            })
                            .style("fill", function (d) {
                                return color(d.job);
                            })
                            .transition()
                            .duration(400);

                        svg.selectAll("circle")
                            .data(data, key)
                            .on("click", function (d) {
                                var tooltip = d3.select("#tooltip");
                                if (tooltip.classed("hidden") == true) {

                                    // Define and show the tooltip

                                    // Get this circle's x/y values, then augment for the tooltip
                                    var xPosition = 0;
                                    if (parseFloat(d3.select(this).attr("cx")) < ((4 * width) / 5)) {
                                        xPosition = parseFloat(d3.select(this).attr("cx")) + 15;
                                    } else {
                                        xPosition = parseFloat(d3.select(this).attr("cx")) - 25 - 185;
                                    }
                            
                                    var yPosition = parseFloat(d3.select(this).attr("cy")) / 2 + height / 10;

                                    // Update the tooltip position and value
                                    d3.select("#tooltip")
                                        .style("left", xPosition + "px")
                                        .style("top", yPosition + "px")
                                        .html(
                                            '<h3>' + '<a href = "' + d.refArea + '" target="_blank">' + d.authorityName + '</a>' + 
                                            '</h3>' + 

                                            '<span>' + 
                                            "Completed house building " + (d.observation).split("/")[7] + " : " + 
                                            '</span>' +

                                            '<a href = "' + d.observation + '" target="_blank">' + d.completions + '</a>' + 
                                            '</br>' +

                                            '<span>' +
                                            "Started house building " + (d.observation).split("/")[7] + " : " +  
                                            '</span>' +

                                            '<a href = "' + d.observation2 + '" target="_blank">' + d.starts + '</a>' + 
                                            '</br>' + 

                                            '<span>' +
                                            "Dwelling Stock " 
                                            + (d.observation3).split("/")[7] + " : " + 
                                            '</span>' +

                                            '<a href = "' + d.observation3 + '" target="_blank">' + d.dwellingStock + '</a>' + 
                                            '</br>' + 

                                            '<span>' +
                                            "Employment rate: " + 
                                            '</span>' +

                                            d.job
                                        );

                                    // Show the tooltip
                                    d3.select("#tooltip").classed("hidden", false);
                                }  else {
                                    //Hide the tooltip
                                    d3.select("#tooltip").classed("hidden", true);
                                }
                            });
                    })
                });
            });
    </script>
</body>
</html>